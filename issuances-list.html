<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Issuances List</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<link rel="stylesheet" href="css/style.css">
</head>

<body>
<div class="wrap">

  <div class="header">
    <div>
      <p class="h-title">Issuances</p>
      <p class="h-sub">
        This page lists all reserve-backed issuances. Choose an issuance and deposit the required token during the Active window.
        Rewards are distributed deterministically by the smart contract on Solana.
      </p>
    </div>

    <div class="search">
      <input id="q" type="text" placeholder="Search (token, status, id…)" />
    </div>
  </div>

  <div id="empty" class="empty">No issuances match your search.</div>
  <div id="grid" class="grid"></div>

</div>

<!-- Modal -->
<div id="mb" class="modal-backdrop" role="dialog" aria-modal="true">
  <div class="modal">
    <h3 id="mtitle">Action</h3>
    <p id="msub">Flow will be connected here (wallet + on-chain transaction).</p>

    <div class="mkv" id="mkv"></div>

    <div class="actions">
      <button class="btn" id="mclose">Close</button>

      <button class="btn btn-primary" id="mdeposit" disabled>Deposit</button>

      <button class="btn btn-claim" id="mclaim" disabled>Claim Reward</button>
      <button class="btn btn-outline" id="mwithdraw" disabled>Withdraw Deposit</button>
    </div>
  </div>
</div>

<script>
const ISSUANCES = [
  {
    issuance_id: "8B5MJ619DV8WcxKLmU7fhXDkKbWK9e58RAJBURV4Pwfe",
    status: "Upcoming",
    lock_symbol: "LOCK",
    reward_symbol: "USDC",
    reserve_total: "1,000,000",
    start: "2026-03-01 00:00 UTC",
    maturity: "2026-03-31 00:00 UTC",
    lock_mint: "LOCK_MINT_EXAMPLE_111111111111111111111111111111",
    reward_mint: "USDC_MINT_EXAMPLE_222222222222222222222222222222",
    deposit_escrow: "DEPOSIT_ESCROW_EXAMPLE_33333333333333333333333",
    reward_escrow: "REWARD_ESCROW_EXAMPLE_444444444444444444444444",
    platform_treasury: "B9xmmg2zPMSwPg7iX7a9J2j6SK5LcopZ8abRDj9ughxw"
  },
  {
    issuance_id: "9yQf8s7YxQj3vZrD4mK2p8pZx4g1VbY7h3mQn1a2b3c4",
    status: "Active",
    lock_symbol: "LOCK",
    reward_symbol: "USDC",
    reserve_total: "250,000",
    start: "2026-02-20 00:00 UTC",
    maturity: "2026-03-21 00:00 UTC",
    lock_mint: "LOCK_MINT_EXAMPLE_555555555555555555555555555555",
    reward_mint: "USDC_MINT_EXAMPLE_222222222222222222222222222222",
    deposit_escrow: "DEPOSIT_ESCROW_EXAMPLE_66666666666666666666666",
    reward_escrow: "REWARD_ESCROW_EXAMPLE_777777777777777777777777",
    platform_treasury: "B9xmmg2zPMSwPg7iX7a9J2j6SK5LcopZ8abRDj9ughxw"
  },
  {
    issuance_id: "4mN2pQ7vXk9sT3aB5cD8eF1gH6jK2lM9nP4qR7sT8uV",
    status: "Claiming",
    lock_symbol: "LOCK",
    reward_symbol: "USDC",
    reserve_total: "75,000",
    start: "2026-01-10 00:00 UTC",
    maturity: "2026-02-09 00:00 UTC",
    lock_mint: "LOCK_MINT_EXAMPLE_888888888888888888888888888888",
    reward_mint: "USDC_MINT_EXAMPLE_222222222222222222222222222222",
    deposit_escrow: "DEPOSIT_ESCROW_EXAMPLE_99999999999999999999999",
    reward_escrow: "REWARD_ESCROW_EXAMPLE_AAAAAAAAAAAAAAAAAAAAAAAAAA",
    platform_treasury: "B9xmmg2zPMSwPg7iX7a9J2j6SK5LcopZ8abRDj9ughxw"
  }
];

const grid = document.getElementById("grid");
const empty = document.getElementById("empty");
const q = document.getElementById("q");

/* modal refs */
const mb = document.getElementById("mb");
const mclose = document.getElementById("mclose");
const mtitle = document.getElementById("mtitle");
const msub = document.getElementById("msub");
const mkv = document.getElementById("mkv");
const mdeposit = document.getElementById("mdeposit");
const mclaim = document.getElementById("mclaim");
const mwithdraw = document.getElementById("mwithdraw");

function badgeClass(status){
  const s = String(status || "").toLowerCase();
  if (s === "upcoming") return "upcoming";
  if (s === "active") return "active";
  if (s === "claiming") return "claiming";
  if (s === "closed") return "closed";
  return "";
}

function canDeposit(status){
  return String(status || "").toLowerCase() === "active";
}

function canSettle(status){
  const s = String(status || "").toLowerCase();
  return s === "claiming" || s === "closed";
}

function esc(s){ return String(s || ""); }

/* Toggle modal buttons by mode */
function setModalMode(mode){
  // reset all
  mdeposit.style.display = "none";
  mclaim.style.display = "none";
  mwithdraw.style.display = "none";

  // disable by default
  mdeposit.disabled = true;
  mclaim.disabled = true;
  mwithdraw.disabled = true;

  if (mode === "deposit"){
    mdeposit.style.display = "inline-block";
  } else if (mode === "settle"){
    mclaim.style.display = "inline-block";
    mwithdraw.style.display = "inline-block";
  }
}

function openDepositModal(it){
  mtitle.textContent = `Deposit — ${esc(it.lock_symbol)}`;
  msub.textContent = "Wallet deposit flow will be connected here (Phantom/Solflare + on-chain transaction).";

  mkv.innerHTML = `
    <div class="mrow"><span>Issuance</span><code>${esc(it.issuance_id)}</code></div>
    <div class="mrow"><span>Deposit token</span><code>${esc(it.lock_symbol)}</code></div>
    <div class="mrow"><span>Reward token</span><code>${esc(it.reward_symbol)}</code></div>
    <div class="mrow"><span>Deposit escrow</span><code>${esc(it.deposit_escrow)}</code></div>
  `;

  setModalMode("deposit");
  mdeposit.textContent = "Deposit";
  mb.style.display = "flex";
}

function openSettleModal(it){
  mtitle.textContent = "Withdraw Funds";
  msub.textContent = "Claim/withdraw flow will be connected here (wallet + on-chain transaction).";

  mkv.innerHTML = `
    <div class="mrow"><span>Issuance</span><code>${esc(it.issuance_id)}</code></div>
    <div class="mrow"><span>Status</span><code>${esc(it.status)}</code></div>
    <div class="mrow"><span>Reward token</span><code>${esc(it.reward_symbol)}</code></div>
    <div class="mrow"><span>Reward escrow</span><code>${esc(it.reward_escrow)}</code></div>
    <div class="mrow"><span>Deposit escrow</span><code>${esc(it.deposit_escrow)}</code></div>
  `;

  setModalMode("settle");

  mclaim.textContent = "Claim Reward";
  mwithdraw.textContent = "Withdraw Deposit";

  mb.style.display = "flex";
}

function openDetailsModal(it){
  mtitle.textContent = "Issuance Details";
  msub.textContent = "On-chain configuration and program accounts.";

  mkv.innerHTML = `
    <div class="mrow"><span>Issuance PDA</span><code>${esc(it.issuance_id)}</code></div>
    <div class="mrow"><span>Lock mint</span><code>${esc(it.lock_mint)}</code></div>
    <div class="mrow"><span>Reward mint</span><code>${esc(it.reward_mint)}</code></div>
    <div class="mrow"><span>Deposit escrow</span><code>${esc(it.deposit_escrow)}</code></div>
    <div class="mrow"><span>Reward escrow</span><code>${esc(it.reward_escrow)}</code></div>
    <div class="mrow"><span>Platform treasury</span><code>${esc(it.platform_treasury)}</code></div>
  `;

  // hide action buttons (Details mode)
  mdeposit.style.display = "none";
  mclaim.style.display = "none";
  mwithdraw.style.display = "none";

  mb.style.display = "flex";
}

function closeModal(){ mb.style.display = "none"; }

function render(list){
  grid.innerHTML = "";
  if (!list.length){
    empty.style.display = "block";
    return;
  }
  empty.style.display = "none";

  for (const it of list){
    const card = document.createElement("div");
    card.className = "card";

    const top = document.createElement("div");
    top.className = "topline";

    const idline = document.createElement("div");
    idline.className = "idline";
    idline.title = it.issuance_id;
    idline.textContent = it.issuance_id;

    const badge = document.createElement("div");
    badge.className = "badge " + badgeClass(it.status);
    badge.textContent = it.status;

    top.appendChild(idline);
    top.appendChild(badge);

    const kv = document.createElement("div");
    kv.className = "kv";
    kv.innerHTML = `
      <div><div class="k">Deposit token</div><div class="v">${esc(it.lock_symbol)}</div></div>
      <div><div class="k">Reward token</div><div class="v">${esc(it.reward_symbol)}</div></div>
      <div><div class="k">Reserve total</div><div class="v">${esc(it.reserve_total)} ${esc(it.reward_symbol)}</div></div>
      <div><div class="k">Maturity</div><div class="v">${esc(it.maturity)}</div></div>
      <div><div class="k">Start</div><div class="v">${esc(it.start)}</div></div>
      <div><div class="k">Network</div><div class="v">mainnet</div></div>
    `;

    const row = document.createElement("div");
    row.className = "row";

    const btnDetails = document.createElement("button");
    btnDetails.className = "btn btn-outline";
    btnDetails.textContent = "Details";

    const btnDeposit = document.createElement("button");
    btnDeposit.className = "btn btn-primary";
    btnDeposit.textContent = "Deposit";
    btnDeposit.disabled = !canDeposit(it.status);
    btnDeposit.title = canDeposit(it.status)
      ? "Deposit into this issuance"
      : "Deposit is available only when status = Active";

    const btnSettle = document.createElement("button");
    btnSettle.className = "btn btn-claim";
    btnSettle.textContent = "Withdraw Funds";
    btnSettle.disabled = !canSettle(it.status);
    btnSettle.title = canSettle(it.status)
      ? "Claim rewards and/or withdraw deposit after maturity"
      : "Available only when status = Claiming/Closed";

    row.appendChild(btnDetails);
    row.appendChild(btnDeposit);
    row.appendChild(btnSettle);

    btnDetails.addEventListener("click", () => openDetailsModal(it));
    btnDeposit.addEventListener("click", () => openDepositModal(it));
    btnSettle.addEventListener("click", () => openSettleModal(it));

    card.appendChild(top);
    card.appendChild(kv);
    card.appendChild(row);

    grid.appendChild(card);
  }
}

function filterList(){
  const s = (q.value || "").trim().toLowerCase();
  if (!s) return ISSUANCES.slice();
  return ISSUANCES.filter(it => {
    const hay = [
      it.issuance_id, it.status, it.lock_symbol, it.reward_symbol,
      it.reserve_total, it.start, it.maturity
    ].join(" ").toLowerCase();
    return hay.includes(s);
  });
}

q.addEventListener("input", () => render(filterList()));

mclose.addEventListener("click", closeModal);
mb.addEventListener("click", (e) => { if (e.target === mb) closeModal(); });

mdeposit.addEventListener("click", () => alert("Deposit flow"));
mclaim.addEventListener("click", () => alert("Claim reward flow"));
mwithdraw.addEventListener("click", () => alert("Withdraw deposit flow"));

render(filterList());
</script>
</body>
</html>